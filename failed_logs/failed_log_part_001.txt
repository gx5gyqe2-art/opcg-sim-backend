=== ❌ FAILED SCENARIO: [BASIC_KO_AND_COST] 【基本】コスト指定KOとドン!!コスト支払い ===

--- [1. SCENARIO DEFINITION] ---
{
  "id": "BASIC_KO_AND_COST",
  "title": "【基本】コスト指定KOとドン!!コスト支払い",
  "setup": {
    "p1": {
      "field": [
        "Tester"
      ],
      "don_active": 2,
      "don_deck": 8
    },
    "p2": {
      "field": [
        "HighCostEnemy",
        {
          "name": "LowCostEnemy",
          "cost": 4
        }
      ],
      "trash": [
        "LowCostEnemy"
      ]
    }
  },
  "source": "Tester",
  "text": "【起動メイン】ドン!!-1(自分の場のドン!!を指定の数ドン!!デッキに戻すことができる)：コスト4以下の相手のキャラ1枚をKOする。",
  "expected_trigger": "ACTIVATE_MAIN",
  "interaction": [
    {
      "select_cards": [
        "LowCostEnemy"
      ]
    }
  ],
  "expect": {
    "success": true,
    "p1_don_active": 1,
    "p1_don_deck_count": 9,
    "p2_field_has": [
      "HighCostEnemy"
    ],
    "p2_trash_has": [
      "LowCostEnemy"
    ]
  }
}

--- [2. EXECUTION LOG] ---
{"timestamp": "2026-01-08T23:13:54.371355", "source": "BE", "level": "INFO", "sessionId": "gen-cc46a47e", "player": "system", "action": "game.start", "msg": "Game initialization started", "payload": null}
{"timestamp": "2026-01-08T23:13:54.371754", "source": "BE", "level": "INFO", "sessionId": "gen-cc46a47e", "player": "P1", "action": "game.turn_player", "msg": "First Player: P1", "payload": null}
{"timestamp": "2026-01-08T23:13:54.375970", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "system", "action": "matcher.parse_start", "msg": "Parsing target text: ドン-1", "payload": null}
{"timestamp": "2026-01-08T23:13:54.377817", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "system", "action": "matcher.parse_result", "msg": "Parsed: player=SELF, count=1, up_to=False, zone=Zone.COST_AREA", "payload": null}
{"timestamp": "2026-01-08T23:13:54.377956", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "system", "action": "matcher.parse_start", "msg": "Parsing target text: コスト4以下の相手のキャラ1枚をKOする", "payload": null}
{"timestamp": "2026-01-08T23:13:54.378164", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "system", "action": "matcher.parse_result", "msg": "Parsed: player=OPPONENT, count=1, up_to=False, zone=Zone.FIELD", "payload": null}
{"timestamp": "2026-01-08T23:13:54.378258", "source": "BE", "level": "INFO", "sessionId": "gen-cc46a47e", "player": "P1", "action": "game.effect", "msg": "Resolving action ActionType.RETURN_DON for Tester", "payload": null}
{"timestamp": "2026-01-08T23:13:54.396872", "source": "BE", "level": "INFO", "sessionId": "gen-cc46a47e", "player": "P1", "action": "resolver.suspend", "msg": "Selection required for ActionType.RETURN_DON. Candidates: 2", "payload": null}

--- [3. RESULT REPORT] ---
✅ Trigger matched: ACTIVATE_MAIN
Runtime Error: 'DonInstance' object has no attribute 'master'
❌ Success Mismatch: Expected True, Got False
❌ p1 Don Active: Expected 1, Got 2
❌ p1 Don Deck Count: Expected 9, Got 8
✅ P2 Field has HighCostEnemy
✅ P2 Trash has LowCostEnemy

============================================================
=== ❌ FAILED SCENARIO: [ST02_007_BONNEY] 【起動メイン】超新星サーチ（ジュエリー・ボニー） ===

--- [1. SCENARIO DEFINITION] ---
{
  "id": "ST02_007_BONNEY",
  "title": "【起動メイン】超新星サーチ（ジュエリー・ボニー）",
  "setup": {
    "p1": {
      "field": [
        {
          "name": "ST02-007 Jewelry Bonney",
          "cost": 1,
          "power": 1000,
          "attribute": "SPECIAL",
          "color": "GREEN",
          "traits": [
            "超新星",
            "ボニー海賊団"
          ],
          "text": "【起動メイン】①(コストエリアのドン!!を指定の数レストにできる)，このキャラをレストにできる：自分のデッキの上から5枚を見て、特徴《超新星》を持つカード1枚までを公開し、手札に加える。その後、残りを好きな順番でデッキの下に置く。"
        }
      ],
      "deck": [
        {
          "name": "Supernova Card",
          "traits": [
            "超新星"
          ]
        },
        "CardA",
        "CardB",
        "CardC",
        "CardD",
        "BottomCard",
        "D1",
        "D2",
        "D3"
      ],
      "don": {
        "active": 1,
        "rested": 0
      }
    }
  },
  "source": "ST02-007 Jewelry Bonney",
  "expected_trigger": "ACTIVATE_MAIN",
  "interaction": [
    {
      "select_cards": [
        "Supernova Card"
      ]
    },
    {
      "sort_deck_bottom": [
        "CardA",
        "CardB",
        "CardC",
        "CardD"
      ]
    }
  ],
  "expect": {
    "success": true,
    "p1_hand_has": [
      "Supernova Card"
    ],
    "p1_field_status": {
      "ST02-007 Jewelry Bonney": "REST"
    },
    "p1_don_active": 0,
    "p1_don_rested": 1
  },
  "text": "【起動メイン】①(コストエリアのドン!!を指定の数レストにできる)，このキャラをレストにできる：自分のデッキの上から5枚を見て、特徴《超新星》を持つカード1枚までを公開し、手札に加える。その後、残りを好きな順番でデッキの下に置く。"
}

--- [2. EXECUTION LOG] ---
{"timestamp": "2026-01-08T23:13:54.790450", "source": "BE", "level": "INFO", "sessionId": "gen-cc46a47e", "player": "system", "action": "game.start", "msg": "Game initialization started", "payload": null}
{"timestamp": "2026-01-08T23:13:54.790540", "source": "BE", "level": "INFO", "sessionId": "gen-cc46a47e", "player": "P1", "action": "game.turn_player", "msg": "First Player: P1", "payload": null}
{"timestamp": "2026-01-08T23:13:54.791530", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "system", "action": "matcher.parse_start", "msg": "Parsing target text: ドン1枚をレストにする,このキャラをレストにできる", "payload": null}
{"timestamp": "2026-01-08T23:13:54.791728", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "system", "action": "matcher.parse_result", "msg": "Parsed: player=SELF, count=1, up_to=False, zone=Zone.FIELD", "payload": null}
{"timestamp": "2026-01-08T23:13:54.791854", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "system", "action": "matcher.parse_start", "msg": "Parsing target text: 自分のデッキの上から5枚を見て、特徴《超新星》を持つカード1枚までを公開し、手札に加える", "payload": null}
{"timestamp": "2026-01-08T23:13:54.792033", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "system", "action": "matcher.parse_result", "msg": "Parsed: player=SELF, count=5, up_to=True, zone=Zone.DECK", "payload": null}
{"timestamp": "2026-01-08T23:13:54.792169", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "system", "action": "matcher.parse_start", "msg": "Parsing target text: 残りを好きな順番でデッキの下に置く", "payload": null}
{"timestamp": "2026-01-08T23:13:54.792282", "source": "BE", "level": "INFO", "sessionId": "gen-cc46a47e", "player": "P1", "action": "game.effect", "msg": "Resolving action ActionType.REST for ST02-007 Jewelry Bonney", "payload": null}
{"timestamp": "2026-01-08T23:13:54.792366", "source": "BE", "level": "INFO", "sessionId": "gen-cc46a47e", "player": "P1", "action": "resolver.suspend", "msg": "Selection required for ActionType.REST. Candidates: 1", "payload": null}
{"timestamp": "2026-01-08T23:13:54.792468", "source": "BE", "level": "INFO", "sessionId": "gen-cc46a47e", "player": "P1", "action": "game.resume_effect", "msg": "Resuming effect for ST02-007 Jewelry Bonney", "payload": null}
{"timestamp": "2026-01-08T23:13:54.792564", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "P1", "action": "resolver.fail_no_target", "msg": "Action ActionType.REST failed: Target required but not found.", "payload": null}
{"timestamp": "2026-01-08T23:13:54.792629", "source": "BE", "level": "WARNING", "sessionId": "gen-cc46a47e", "player": "P1", "action": "game.effect_failed", "msg": "効果の解決に失敗しました: ドン1枚をレストにする,このキャラをレストにできる", "payload": null}

--- [3. RESULT REPORT] ---
✅ Trigger matched: ACTIVATE_MAIN
Caught Expected Error: 効果の解決に失敗しました: ドン1枚をレストにする,このキャラをレストにできる
❌ Success Mismatch: Expected True, Got False
❌ p1 Don Active: Expected 0, Got 1
❌ P1 Hand missing Supernova Card. Current: []

============================================================
=== ❌ FAILED SCENARIO: [OP09_095_LAFFITTE] 【起動メイン】黒ひげ海賊団サーチ（ラフィット） ===

--- [1. SCENARIO DEFINITION] ---
{
  "id": "OP09_095_LAFFITTE",
  "title": "【起動メイン】黒ひげ海賊団サーチ（ラフィット）",
  "setup": {
    "p1": {
      "field": [
        {
          "name": "OP09-095 Laffitte",
          "cost": 1,
          "power": 1000,
          "attribute": "STRIKE",
          "color": "BLACK",
          "traits": [
            "黒ひげ海賊団"
          ],
          "text": "【起動メイン】自分のドン!!1枚とこのキャラをレストにできる：自分のデッキの上から5枚を見て、特徴《黒ひげ海賊団》を持つカード1枚までを公開し、手札に加える。その後、残りを好きな順番でデッキの下に置く。"
        }
      ],
      "deck": [
        {
          "name": "Blackbeard Card",
          "traits": [
            "黒ひげ海賊団"
          ]
        },
        "Card1",
        "Card2",
        "Card3",
        "Card4",
        "D1",
        "D2",
        "D3",
        "D4",
        "D5"
      ],
      "don": {
        "active": 1,
        "rested": 0
      }
    }
  },
  "source": "OP09-095 Laffitte",
  "expected_trigger": "ACTIVATE_MAIN",
  "interaction": [
    {
      "select_cards": [
        "Blackbeard Card"
      ]
    },
    {
      "sort_deck_bottom": [
        "Card1",
        "Card2",
        "Card3",
        "Card4"
      ]
    }
  ],
  "expect": {
    "success": true,
    "p1_hand_has": [
      "Blackbeard Card"
    ],
    "p1_field_status": {
      "OP09-095 Laffitte": "REST"
    },
    "p1_don_active": 0,
    "p1_don_rested": 1
  },
  "text": "【起動メイン】自分のドン!!1枚とこのキャラをレストにできる：自分のデッキの上から5枚を見て、特徴《黒ひげ海賊団》を持つカード1枚までを公開し、手札に加える。その後、残りを好きな順番でデッキの下に置く。"
}

--- [2. EXECUTION LOG] ---
{"timestamp": "2026-01-08T23:13:54.803897", "source": "BE", "level": "INFO", "sessionId": "gen-cc46a47e", "player": "system", "action": "game.start", "msg": "Game initialization started", "payload": null}
{"timestamp": "2026-01-08T23:13:54.804302", "source": "BE", "level": "INFO", "sessionId": "gen-cc46a47e", "player": "P1", "action": "game.turn_player", "msg": "First Player: P1", "payload": null}
{"timestamp": "2026-01-08T23:13:54.806561", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "system", "action": "matcher.parse_start", "msg": "Parsing target text: 自分のドン1枚をレストにできる", "payload": null}
{"timestamp": "2026-01-08T23:13:54.806974", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "system", "action": "matcher.parse_result", "msg": "Parsed: player=SELF, count=1, up_to=False, zone=Zone.COST_AREA", "payload": null}
{"timestamp": "2026-01-08T23:13:54.807119", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "system", "action": "matcher.parse_start", "msg": "Parsing target text: 自分のこのキャラをレストにできる", "payload": null}
{"timestamp": "2026-01-08T23:13:54.807262", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "system", "action": "matcher.parse_result", "msg": "Parsed: player=SELF, count=1, up_to=False, zone=Zone.FIELD", "payload": null}
{"timestamp": "2026-01-08T23:13:54.807617", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "system", "action": "matcher.parse_start", "msg": "Parsing target text: 自分のデッキの上から5枚を見て、特徴《黒ひげ海賊団》を持つカード1枚までを公開し、手札に加える", "payload": null}
{"timestamp": "2026-01-08T23:13:54.808104", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "system", "action": "matcher.parse_result", "msg": "Parsed: player=SELF, count=5, up_to=True, zone=Zone.DECK", "payload": null}
{"timestamp": "2026-01-08T23:13:54.808278", "source": "BE", "level": "DEBUG", "sessionId": "gen-cc46a47e", "player": "system", "action": "matcher.parse_start", "msg": "Parsing target text: 残りを好きな順番でデッキの下に置く", "payload": null}
{"timestamp": "2026-01-08T23:13:54.808542", "source": "BE", "level": "INFO", "sessionId": "gen-cc46a47e", "player": "P1", "action": "game.effect", "msg": "Resolving action ActionType.REST for OP09-095 Laffitte", "payload": null}
{"timestamp": "2026-01-08T23:13:54.808753", "source": "BE", "level": "INFO", "sessionId": "gen-cc46a47e", "player": "P1", "action": "resolver.suspend", "msg": "Selection required for ActionType.REST. Candidates: 1", "payload": null}

--- [3. RESULT REPORT] ---
✅ Trigger matched: ACTIVATE_MAIN
Runtime Error: 'DonInstance' object has no attribute 'master'
❌ Success Mismatch: Expected True, Got False
❌ p1 Don Active: Expected 0, Got 1
❌ P1 Hand missing Blackbeard Card. Current: []

============================================================
